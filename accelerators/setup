#!/usr/bin/env bash
set -euo pipefail

install_just() {
  curl --proto '=https' --tlsv1.2 -sSf https://just.systems/install.sh \
  | bash -s -- --to "$HOME/.local/bin"
  echo "$HOME/.local/bin" >> "$GITHUB_PATH"
}

if ! command -v just >/dev/null 2>&1; then
  install_just
fi

# Create just alias (j)
ALIASES_FILE="$HOME/.bash_aliases"

mkdir -p "$(dirname "$ALIASES_FILE")"
touch "$ALIASES_FILE"

add_line_if_missing() {
  local line="$1"
  grep -Fqx "$line" "$ALIASES_FILE" || printf '%s\n' "$line" >> "$ALIASES_FILE"
}

add_line_if_missing "alias j='just'"
add_line_if_missing "complete -F _just -o bashdefault -o default j"

just setup
